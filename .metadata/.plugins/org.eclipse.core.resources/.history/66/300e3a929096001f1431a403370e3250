package com.controller;

import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import com.entity.BookCab;
import com.entity.CabType;
import com.entity.Location;
import com.service.BookCabService;
import com.service.CabService;
import com.service.CabTypeService;
import com.service.DistanceService;
import com.service.LocationService;

@Controller
public class CabBookController {

	
	@Autowired
	BookCabService bookcabService;
	@Autowired
	LocationService locService;
	@Autowired
	CabService cabService;
	@Autowired
	CabTypeService cabtypeService;
	
	@Autowired
	DistanceService distanceService;
	
	
	
	  @RequestMapping(value = "",method=RequestMethod.GET) 
	  public String openPage() { 
		  return "index"; 
		  }

			
			  @RequestMapping(value = "book",method=RequestMethod.GET) public String
			  openBookCab(Model mm, BookCab book) { 
				  List<BookCab> booklist=bookcabService.findAllBooking();
				  
			        List<Location> categories = locService.getallLocation();
			        List<CabType> cabtypes = cabtypeService.getallcabType();
			        mm.addAttribute("categories", categories);
			        mm.addAttribute("cabtypes", cabtypes);
			        mm.addAttribute("bookcab", book);
			       // mm.addAttribute("bookinglist", booklist);
				 
				  return "book"; 
				  }
			 
					
					  @RequestMapping(value = "farecalculate",method=RequestMethod.GET) 
					  public String openFareCalculation(Model mm) { 
						  List<Location> categories = locService.getallLocation();
					        List<CabType> cabtypes = cabtypeService.getallcabType();
					        mm.addAttribute("categories", categories);
					        mm.addAttribute("cabtypes", cabtypes);
						  return "cabbook"; 
						  }
					 
	 @RequestMapping(value = "booking",method = RequestMethod.POST)
	 public String submitcabBooking(Model mm, BookCab book,@ModelAttribute("bookcab") BookCab form) {
		 //hardcode
		 book.setDate(new Date());
		 book.setCab_id(1234L);
		 double distance=distanceService.getDistance(Long.parseLong(book.getSource()), Long.parseLong(book.getDestination()));
		 book.setDistance(distance);
		 		
		 book.setFare(500);
		
		 
		 //hardcode
		  String result = bookcabService.createBooking(book);
		  List<Location> categories = locService.getallLocation();
	        List<CabType> cabtypes = cabtypeService.getallcabType();
	        mm.addAttribute("categories", categories);
	        mm.addAttribute("cabtypes", cabtypes);
		  mm.addAttribute("bookcab",book);
		  mm.addAttribute("result", result);
		 return "book";
		 
	 }


}
